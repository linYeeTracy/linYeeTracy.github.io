<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>linYee&#39;s blog | node - fs</title>
    <meta name="description" content="可长歌，可醉饮，唯不可离去">
    
    
    <link rel="preload" href="/assets/css/0.styles.e9561589.css" as="style"><link rel="preload" href="/assets/js/app.c28e1187.js" as="script"><link rel="preload" href="/assets/js/45.e49fe417.js" as="script"><link rel="prefetch" href="/assets/js/33.5d615819.js"><link rel="prefetch" href="/assets/js/1.314e9720.js"><link rel="prefetch" href="/assets/js/2.b7ae9f51.js"><link rel="prefetch" href="/assets/js/3.1469442e.js"><link rel="prefetch" href="/assets/js/4.8b9c3665.js"><link rel="prefetch" href="/assets/js/5.8f05fa48.js"><link rel="prefetch" href="/assets/js/6.de11eee2.js"><link rel="prefetch" href="/assets/js/7.058c7ab3.js"><link rel="prefetch" href="/assets/js/8.c485cbd9.js"><link rel="prefetch" href="/assets/js/9.14214538.js"><link rel="prefetch" href="/assets/js/10.0c8a647e.js"><link rel="prefetch" href="/assets/js/11.5d18dcd9.js"><link rel="prefetch" href="/assets/js/12.99e91df1.js"><link rel="prefetch" href="/assets/js/13.14fc9d1a.js"><link rel="prefetch" href="/assets/js/14.c09d8685.js"><link rel="prefetch" href="/assets/js/15.a2f4c159.js"><link rel="prefetch" href="/assets/js/16.c8513de2.js"><link rel="prefetch" href="/assets/js/17.77a65d16.js"><link rel="prefetch" href="/assets/js/18.2ed37ee1.js"><link rel="prefetch" href="/assets/js/19.1cf6910b.js"><link rel="prefetch" href="/assets/js/20.5a01f12d.js"><link rel="prefetch" href="/assets/js/21.ed3c83c5.js"><link rel="prefetch" href="/assets/js/22.418ec443.js"><link rel="prefetch" href="/assets/js/23.43c2d579.js"><link rel="prefetch" href="/assets/js/24.106790ab.js"><link rel="prefetch" href="/assets/js/25.83b6967b.js"><link rel="prefetch" href="/assets/js/26.2ddc9425.js"><link rel="prefetch" href="/assets/js/27.623b7ab8.js"><link rel="prefetch" href="/assets/js/28.51006cb3.js"><link rel="prefetch" href="/assets/js/29.0c2dbf0e.js"><link rel="prefetch" href="/assets/js/30.3dfcd80c.js"><link rel="prefetch" href="/assets/js/31.6e3e651d.js"><link rel="prefetch" href="/assets/js/32.a1340061.js"><link rel="prefetch" href="/assets/js/34.806c3aca.js"><link rel="prefetch" href="/assets/js/35.a93ce73b.js"><link rel="prefetch" href="/assets/js/36.88eb63e0.js"><link rel="prefetch" href="/assets/js/37.c53b1529.js"><link rel="prefetch" href="/assets/js/38.d8a736e3.js"><link rel="prefetch" href="/assets/js/39.8d87e087.js"><link rel="prefetch" href="/assets/js/40.abc9cabf.js"><link rel="prefetch" href="/assets/js/41.ab549a3a.js"><link rel="prefetch" href="/assets/js/42.d5b9899d.js"><link rel="prefetch" href="/assets/js/43.180edec4.js"><link rel="prefetch" href="/assets/js/44.fa1da641.js"><link rel="prefetch" href="/assets/js/46.006c5467.js"><link rel="prefetch" href="/assets/js/47.c2f4fe77.js"><link rel="prefetch" href="/assets/js/48.31f7bd25.js"><link rel="prefetch" href="/assets/js/49.ff43b66c.js"><link rel="prefetch" href="/assets/js/50.8097df43.js"><link rel="prefetch" href="/assets/js/51.ff1e2e34.js"><link rel="prefetch" href="/assets/js/52.0b64b055.js"><link rel="prefetch" href="/assets/js/53.d6b07f08.js"><link rel="prefetch" href="/assets/js/54.d90f1430.js"><link rel="prefetch" href="/assets/js/55.36a0f5d2.js"><link rel="prefetch" href="/assets/js/56.3fa1e1fc.js"><link rel="prefetch" href="/assets/js/57.b405dc9e.js"><link rel="prefetch" href="/assets/js/58.e00c43fc.js"><link rel="prefetch" href="/assets/js/59.80b36c49.js"><link rel="prefetch" href="/assets/js/60.a1bbdc6a.js"><link rel="prefetch" href="/assets/js/61.91a83384.js"><link rel="prefetch" href="/assets/js/62.23603e69.js"><link rel="prefetch" href="/assets/js/63.07c9232e.js"><link rel="prefetch" href="/assets/js/64.7e6b1d65.js"><link rel="prefetch" href="/assets/js/65.c802ed55.js"><link rel="prefetch" href="/assets/js/66.eea0beab.js"><link rel="prefetch" href="/assets/js/67.584b410a.js"><link rel="prefetch" href="/assets/js/68.cc18b160.js"><link rel="prefetch" href="/assets/js/69.77e1586e.js"><link rel="prefetch" href="/assets/js/70.2003d970.js"><link rel="prefetch" href="/assets/js/71.60093cc3.js"><link rel="prefetch" href="/assets/js/72.796ad2eb.js"><link rel="prefetch" href="/assets/js/73.c4a8b30b.js"><link rel="prefetch" href="/assets/js/74.feb798c8.js"><link rel="prefetch" href="/assets/js/75.6fb13014.js"><link rel="prefetch" href="/assets/js/76.edb2c0b5.js"><link rel="prefetch" href="/assets/js/77.9e39f58e.js"><link rel="prefetch" href="/assets/js/78.08ca8c00.js"><link rel="prefetch" href="/assets/js/79.7366f16a.js"><link rel="prefetch" href="/assets/js/80.0d2e0e48.js"><link rel="prefetch" href="/assets/js/81.fe23c69b.js"><link rel="prefetch" href="/assets/js/82.ca6ca6a2.js"><link rel="prefetch" href="/assets/js/83.03da1a3f.js"><link rel="prefetch" href="/assets/js/84.db1a588f.js"><link rel="prefetch" href="/assets/js/85.bcc7a0d3.js"><link rel="prefetch" href="/assets/js/86.82e737b3.js"><link rel="prefetch" href="/assets/js/87.ed015db9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e9561589.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      linYee's blog
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/resume/" class="nav-link">简历</a></div><a href="https://github.com/linYeeTracy/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><a href="/resume/" class="nav-link">简历</a></div><a href="https://github.com/linYeeTracy/blogs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/blog/md-example.html" class="sidebar-link">markdown语法实例</a></li><li><a href="/blog/git.html" class="sidebar-link">git 命令行</a></li><li><a href="/blog/github-plugins.html" class="sidebar-link">文档整理</a></li><li><a href="/blog/es6.html" class="sidebar-link">es6</a></li><li><a href="/blog/react.html" class="sidebar-link">react</a></li><li><a href="/blog/ruby-gem.html" class="sidebar-link">ruby-gem</a></li><li><a href="/blog/vue-amap.html" class="sidebar-link">在 Vue 中使用高德地图的一些问题</a></li><li><a href="/blog/vue-business-component.html" class="sidebar-link">谈谈 Vue 业务组件</a></li><li><a href="/blog/axios.html" class="sidebar-link">axios</a></li><li><a href="/blog/babel.html" class="sidebar-link">babel6 的变化</a></li><li><a href="/blog/css技巧.html" class="sidebar-link">css小技巧</a></li><li><a href="/blog/express.html" class="sidebar-link">嘻嘻嘻</a></li><li><a href="/blog/git-github.html" class="sidebar-link">git-github</a></li><li><a href="/blog/gulp插件集合.html" class="sidebar-link">gulp插件集合</a></li><li><a href="/blog/js-array.html" class="sidebar-link">js-array</a></li><li><a href="/blog/js的模块化.html" class="sidebar-link">js的模块化</a></li><li><a href="/blog/jwt.html" class="sidebar-link">jwt</a></li><li><a href="/blog/linux.html" class="sidebar-link">linux</a></li><li><a href="/blog/lodash.html" class="sidebar-link">lodash</a></li><li><a href="/blog/markdown.html" class="sidebar-link">packageJson</a></li><li><a href="/blog/nginx.html" class="sidebar-link">nginx</a></li><li><a href="/blog/node-fs.html" class="active sidebar-link">node - fs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node-fs.html#" class="sidebar-link"></a></li><li class="sidebar-sub-header"><a href="/blog/node-fs.html#基本操作" class="sidebar-link">基本操作</a></li><li class="sidebar-sub-header"><a href="/blog/node-fs.html#判断路径是否存在，不存在则创建" class="sidebar-link">判断路径是否存在，不存在则创建</a></li><li class="sidebar-sub-header"><a href="/blog/node-fs.html#具体示例" class="sidebar-link">具体示例</a></li><li class="sidebar-sub-header"><a href="/blog/node-fs.html#node-文件读取、合并操作-其实都是可以通过shell命令行实现" class="sidebar-link">node 文件读取、合并操作(其实都是可以通过shell命令行实现)</a></li></ul></li><li><a href="/blog/node-express.html" class="sidebar-link">node-express</a></li><li><a href="/blog/node.html" class="sidebar-link">node</a></li><li><a href="/blog/npm整理.html" class="sidebar-link">npm整理</a></li><li><a href="/blog/packageJson.html" class="sidebar-link">packageJson</a></li><li><a href="/blog/pm2.html" class="sidebar-link">pm2</a></li><li><a href="/blog/reduce应用.html" class="sidebar-link">reduce应用及高级技巧</a></li><li><a href="/blog/server.html" class="sidebar-link">server</a></li><li><a href="/blog/vue-router.html" class="sidebar-link">安装</a></li><li><a href="/blog/vue.html" class="sidebar-link">vue</a></li><li><a href="/blog/vuex.html" class="sidebar-link">vuex</a></li><li><a href="/blog/vue生命周期.html" class="sidebar-link">vue生命周期</a></li><li><a href="/blog/webpack整理.html" class="sidebar-link">进击webpack</a></li><li><a href="/blog/分辨率与像素.html" class="sidebar-link">分辨率与像素</a></li><li><a href="/blog/模块化引入方式.html" class="sidebar-link">模块化引入方式</a></li><li><a href="/blog/正则表达式.html" class="sidebar-link">正则表达式</a></li><li><a href="/blog/正则表达式实例整理.html" class="sidebar-link">正则表达式实例整理</a></li><li><a href="/blog/xingnengyouhua.html" class="sidebar-link">前端性能优化总结</a></li></ul></div><div class="page"><div class="content"><h2 id><a href="#" aria-hidden="true" class="header-anchor">#</a></h2><p>async await</p><h2 id="基本操作"><a href="#基本操作" aria-hidden="true" class="header-anchor">#</a> 基本操作</h2><h3 id="fs-stat-检测是文件还是目录-目录-文件是否存在"><a href="#fs-stat-检测是文件还是目录-目录-文件是否存在" aria-hidden="true" class="header-anchor">#</a> fs.stat  检测是文件还是目录(目录 文件是否存在)</h3><blockquote><p>fs.statSync()同步获取stats对象,通过返回值接收</p></blockquote><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>stats<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件：'</span><span class="token operator">+</span>stats<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'目录：'</span><span class="token operator">+</span>stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="fs-mkdir-创建目录"><a href="#fs-mkdir-创建目录" aria-hidden="true" class="header-anchor">#</a> fs.mkdir  创建目录</h3><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">'css'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建目录成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="fs-writefile-写入文件（会覆盖之前的内容）（文件不存在就创建）-utf8参数可以省略"><a href="#fs-writefile-写入文件（会覆盖之前的内容）（文件不存在就创建）-utf8参数可以省略" aria-hidden="true" class="header-anchor">#</a> fs.writeFile 写入文件（会覆盖之前的内容）（文件不存在就创建）  utf8参数可以省略</h3><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'123.txt'</span><span class="token punctuation">,</span><span class="token string">'你好nodejs 覆盖'</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="fs-appendfile-追加文件"><a href="#fs-appendfile-追加文件" aria-hidden="true" class="header-anchor">#</a> fs.appendFile 追加文件</h3><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'123.txt'</span><span class="token punctuation">,</span><span class="token string">'这是写入的内容\n'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="fs-readfile-读取文件"><a href="#fs-readfile-读取文件" aria-hidden="true" class="header-anchor">#</a> fs.readFile 读取文件</h3><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'123.txt'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//console.log(data);  //data是读取的十六进制的数据。  也可以在参数中加入编码格式&quot;utf8&quot;来解决十六进制的问题;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//读取出所有行的信息  </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="fs-readdir-读取目录下第一级内容-把目录下面的文件和文件夹都获取到。"><a href="#fs-readdir-读取目录下第一级内容-把目录下面的文件和文件夹都获取到。" aria-hidden="true" class="header-anchor">#</a> fs.readdir 读取目录下第一级内容  把目录下面的文件和文件夹都获取到。</h3><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//data是数组类型，包含文件夹以及文件的名字(只有第一级目录内容)。拿到一个文件夹下面的所有目录  </span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="fs-rename-重命名-1-改名-2-剪切文件-移动"><a href="#fs-rename-重命名-1-改名-2-剪切文件-移动" aria-hidden="true" class="header-anchor">#</a> fs.rename 重命名  1.改名  2.剪切文件(移动)</h3><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">'html/index.html'</span><span class="token punctuation">,</span><span class="token string">'html/news.html'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改名字成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="fs-rmdir-只能删除目录，不能删除文件"><a href="#fs-rmdir-只能删除目录，不能删除文件" aria-hidden="true" class="header-anchor">#</a> fs.rmdir 只能删除目录，不能删除文件</h3><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token string">'abc目录'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'删除目录成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="fs-unlink-删除文件"><a href="#fs-unlink-删除文件" aria-hidden="true" class="header-anchor">#</a> fs.unlink 删除文件</h3><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">'index.txt'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'删除文件成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><h3 id="fs-createreadstream-从文件流中读取数据，读取的文件比较大时建议用流的方式读取，文件比较大会多次读取。"><a href="#fs-createreadstream-从文件流中读取数据，读取的文件比较大时建议用流的方式读取，文件比较大会多次读取。" aria-hidden="true" class="header-anchor">#</a> fs.createReadStream  从文件流中读取数据，读取的文件比较大时建议用流的方式读取，文件比较大会多次读取。</h3><pre class="language-js"><code><span class="token keyword">var</span> fileReadStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span> <span class="token string">'data1.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
fileReadStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;接收到&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//文件比较大时，会多次读取，多次执行该回调函数  </span>
str <span class="token operator">+=</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fileReadStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot; --- 结束 ---&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> str <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
fileReadStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="pipe-管道流"><a href="#pipe-管道流" aria-hidden="true" class="header-anchor">#</a> pipe 管道流</h3><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> readerStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span> <span class="token string">'input.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> writerStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span> <span class="token string">'output.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
readerStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span> writerStream <span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;程序执行完毕&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="fs-access-判断目录、文件是否存在-读写权限"><a href="#fs-access-判断目录、文件是否存在-读写权限" aria-hidden="true" class="header-anchor">#</a> fs.access 判断目录、文件是否存在(读写权限)</h3><pre class="language-js"><code><span class="token keyword">var</span>  fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">'package.json'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err <span class="token operator">?</span>  <span class="token string">'目录/文件不存在'</span><span class="token punctuation">:</span> <span class="token string">'文件存在,可以进行读写'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="fs-writefile"><a href="#fs-writefile" aria-hidden="true" class="header-anchor">#</a> fs.writeFile</h3><blockquote><p>以异步的方式将data写入文件，文件已存在的情况下，原内容被替换</p></blockquote><p>fs.writeFile(filename, data, [options], [callback(err)])</p><pre class="language-text"><code>fs.writeFile('message.txt', 'Hello Node', function (err) {
  if (err) throw err;
  console.log('It\'s saved!');
});
</code></pre><p>源码</p><pre class="language-text"><code>fs.writeFile = function(path, data, options, callback) {
  var callback = maybeCallback(arguments[arguments.length - 1]);
  if (util.isFunction(options) || !options) {
    options = { encoding: 'utf8', mode: 438 /*=0666*/, flag: 'w' };
  } else if (util.isString(options)) {
    options = { encoding: options, mode: 438, flag: 'w' };
  } else if (!util.isObject(options)) {
    throw new TypeError('Bad arguments');
  }
  assertEncoding(options.encoding);
  var flag = options.flag || 'w';
  fs.open(path, options.flag || 'w', options.mode, function(openErr, fd) {
    if (openErr) {
      if (callback) callback(openErr);
    } else {
      var buffer = util.isBuffer(data) ? data : new Buffer('' + data,
          options.encoding || 'utf8');
      var position = /a/.test(flag) ? null : 0;
      writeAll(fd, buffer, 0, buffer.length, position, callback);
    }
  });
};
</code></pre><h2 id="判断路径是否存在，不存在则创建"><a href="#判断路径是否存在，不存在则创建" aria-hidden="true" class="header-anchor">#</a> 判断路径是否存在，不存在则创建</h2><p><a href="https://blog.csdn.net/samfung09/article/details/80906577" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/samfung09/article/details/80906577</a></p><h2 id="具体示例"><a href="#具体示例" aria-hidden="true" class="header-anchor">#</a> 具体示例</h2><h3 id="读文件夹，读完后读文件夹中的所有文件-当a异步任务完成后，继续并发n个b异步任务，使用asnyc函数实现"><a href="#读文件夹，读完后读文件夹中的所有文件-当a异步任务完成后，继续并发n个b异步任务，使用asnyc函数实现" aria-hidden="true" class="header-anchor">#</a> 读文件夹，读完后读文件夹中的所有文件(当A异步任务完成后，继续并发n个B异步任务，使用asnyc函数实现)</h3><pre class="language-text"><code>const readdir = function (path) { // 读文件函数
  return new Promise((res, rej) =&gt; {
    fs.readdir(path, (err, files) =&gt; {
      if(err) res(err)
      res(files)
    })
  })
}
const stat = function (path) { // 确认是否是文件夹
  return new Promise((res, rej) =&gt; {
    fs.stat(path, (err, file) =&gt; {
      if(err) res(err)
      file.isDirectory() ? res('dir') :res('file') // 返回类型结果
    })
  })
}
const getdirs = async function(ctx) {
  let sendFiles = []
  const files = await readdir(filePath) // 读文件夹
  const promises = files.map(function(file){ // 利用map函数特性，返回值组成新的数组，这儿并没有用async函数，map内并不等待一个stat回来后再进行另一个stat，是同时进行的。
    return stat(filePath + '/' + file)
      .then(res =&gt; {
        if(res === 'dir') sendFiles.push(file)
      })
  })
  await Promise.all(promises) // 这儿是异步并发的关键，在这个位置等待所有promise对象resolve。
  ctx.body = sendFiles 
}
</code></pre><h2 id="node-文件读取、合并操作-其实都是可以通过shell命令行实现"><a href="#node-文件读取、合并操作-其实都是可以通过shell命令行实现" aria-hidden="true" class="header-anchor">#</a> node 文件读取、合并操作(其实都是可以通过shell命令行实现)</h2><h3 id="找去匹配的内容"><a href="#找去匹配的内容" aria-hidden="true" class="header-anchor">#</a> 找去匹配的内容</h3><pre class="language-js"><code><span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/Users/**/desktop/Test.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><h3 id="读取文件"><a href="#读取文件" aria-hidden="true" class="header-anchor">#</a> 读取文件</h3><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/Users/**/desktop/mark.log'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'/Users/caofan/desktop/Test.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The &quot;data to append&quot; was appended to file!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="按行读取单个文件"><a href="#按行读取单个文件" aria-hidden="true" class="header-anchor">#</a> 按行读取单个文件</h3><pre class="language-js"><code><span class="token keyword">var</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> fReadName <span class="token operator">=</span> <span class="token string">'/Users/**/desktop/title/title_20171101.log'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fWriteName <span class="token operator">=</span> <span class="token string">'./emoji1.csv'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fRead <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>fReadName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fWrite <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>fWriteName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> enableWriteIndex <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> objReadline <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    input<span class="token punctuation">:</span> fRead
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> matchArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

objReadline<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableWriteIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            matchArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
            <span class="token keyword">var</span> tmp <span class="token operator">=</span> line<span class="token punctuation">;</span>
            fWrite<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>tmp <span class="token operator">+</span> os<span class="token punctuation">.</span><span class="token constant">EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// if (matchArr.length &lt;= 10) {      //输出匹配的前10条</span>
            <span class="token comment">//     console.log(line)</span>
            <span class="token comment">//     // fs.writeFileSync(fWriteName, line+ '\n', 'utf8');</span>
            <span class="token comment">//     var tmp = 'line' + matchArr.length + ':' + line;</span>
            <span class="token comment">//     fWrite.write(tmp + os.EOL);   //  将匹配的前10条写入另一个文件 </span>
            <span class="token comment">// }</span>
        <span class="token punctuation">}</span>
        index <span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fRead<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    enableWriteIndex <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>matchArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span>  <span class="token comment">// 总共匹配的条数</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

objReadline<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="合并目录下的多个文件到另一个文件"><a href="#合并目录下的多个文件到另一个文件" aria-hidden="true" class="header-anchor">#</a> 合并目录下的多个文件到另一个文件</h3><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//配置远程路径</span>
<span class="token keyword">var</span> remotePath <span class="token operator">=</span> <span class="token string">&quot;./emoji&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 相对路径</span>
<span class="token comment">//读取文件目录</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>remotePath<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>files<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> filedir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>remotePath<span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>filedir<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stats<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/emoji/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
                     <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>remotePath<span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
                     fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'/Users/caofan/desktop/Test.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="读取文件目录下的所有文件，匹配内容输出到新的文件"><a href="#读取文件目录下的所有文件，匹配内容输出到新的文件" aria-hidden="true" class="header-anchor">#</a> 读取文件目录下的所有文件，匹配内容输出到新的文件</h3><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//解析需要遍历的文件夹</span>
<span class="token keyword">var</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'/Users/**/desktop/title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//调用文件遍历方法</span>
<span class="token function">fileDisplay</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fWriteName <span class="token operator">=</span> <span class="token string">'./emojis2.csv'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> matchArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fileDisplay</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//根据文件路径读取文件，返回文件列表</span>
    fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>files<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token comment">//遍历读取到的文件列表</span>
            files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//获取当前文件的绝对路径</span>
                <span class="token keyword">var</span> filedir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//根据文件路径获取文件信息，返回一个fs.Stats对象</span>
                fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>filedir<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>eror<span class="token punctuation">,</span>stats<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>eror<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'获取文件stats失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token keyword">var</span> isFile <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是文件</span>
                        <span class="token keyword">var</span> isDir <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//是文件夹</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>isFile<span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/title_201711/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">var</span> fRead <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>filedir<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">var</span> fWrite <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>fWriteName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">var</span> enableWriteIndex <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                                <span class="token keyword">var</span> objReadline <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      <span class="token comment">// 按行读取</span>
                                    input<span class="token punctuation">:</span> fRead
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                objReadline<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'line'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>enableWriteIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/[\]\{\}&lt;&gt;\[@【】「」#\*\^]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                            matchArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
                                            <span class="token keyword">if</span> <span class="token punctuation">(</span>matchArr<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                                <span class="token keyword">var</span> tmp <span class="token operator">=</span> line<span class="token punctuation">;</span>
                                                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
                                                fWrite<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>tmp <span class="token operator">+</span> os<span class="token punctuation">.</span><span class="token constant">EOL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                            <span class="token punctuation">}</span>
                                        <span class="token punctuation">}</span>
                                        index <span class="token operator">++</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                objReadline<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>matchArr<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
                                   <span class="token comment">// console.log(index)</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>isDir<span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token function">fileDisplay</span><span class="token punctuation">(</span>filedir<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//递归，如果是文件夹，就继续遍历该文件夹下面的文件</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="多个目录文件合并成一个"><a href="#多个目录文件合并成一个" aria-hidden="true" class="header-anchor">#</a> 多个目录文件合并成一个</h3><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> baseUrl <span class="token operator">=</span> <span class="token string">'./data'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> createJson <span class="token operator">=</span> <span class="token string">'./data.json'</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>baseUrl<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">var</span> filePath <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> fileReadStream<span class="token punctuation">;</span>
        <span class="token keyword">var</span> fileWriteStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>createJson<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token function">createStramFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> fileNum <span class="token operator">=</span> files<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">createStramFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> currentfile <span class="token operator">=</span> baseUrl<span class="token operator">+</span><span class="token string">'/'</span> <span class="token operator">+</span> files<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileReadStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>currentfile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileReadStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>fileWriteStream<span class="token punctuation">,</span><span class="token punctuation">{</span>end<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileReadStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>currentfile <span class="token operator">+</span> <span class="token string">' appended'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">createStramFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>files<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                fileWriteStream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&quot;Done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'copy Done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            fileWriteStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'copy data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> chunk<span class="token operator">+</span><span class="token string">','</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            fileWriteStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fileNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">roMockJs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token operator">--</span>fileNum<span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'copy over'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//roMockJs();</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="遍历文件夹"><a href="#遍历文件夹" aria-hidden="true" class="header-anchor">#</a> 遍历文件夹</h3><p>并行</p><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">walk</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> pending <span class="token operator">=</span> list<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      file <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
      fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stat <span class="token operator">&amp;&amp;</span> stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">walk</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            results <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">--</span>pending<span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">--</span>pending<span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>串行</p><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">walk</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> file <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
      file <span class="token operator">=</span> dir <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> file<span class="token punctuation">;</span>
      fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stat <span class="token operator">&amp;&amp;</span> stat<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">walk</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            results <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>测试</p><pre class="language-js"><code><span class="token function">walk</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">HOME</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><!----><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/blog/nginx.html" class="prev">
          nginx
        </a></span><span class="next"><a href="/blog/node-express.html">
          node-express
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/45.e49fe417.js" defer></script><script src="/assets/js/app.c28e1187.js" defer></script>
  </body>
</html>
